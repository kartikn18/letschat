<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title><%= title || 'Register' %></title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: radial-gradient(circle at top, #1a1a2e, #000);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    color: #fff;
}

.container {
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(14px);
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    width: 100%;
    max-width: 420px;
    padding: 40px;
    border: 1px solid rgba(255,255,255,0.15);
}

/* Logo + spacing */
.logo { text-align: center; margin-bottom: 12px; }
.logo h1 { color: #b69cff; font-size: 28px; }

.form-title { text-align: center; font-size: 24px; margin-bottom: 6px; }
.form-subtitle { text-align: center; color: #aaa; font-size: 14px; margin-bottom: 8px; }

/* Tagline */
.tagline-bar {
    width: 100%;
    text-align: center;
    padding: 10px 15px;
    margin-bottom: 22px;
    background: linear-gradient(
        135deg,
        rgba(182,156,255,0.18),
        rgba(138,108,255,0.05)
    );
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    box-shadow: 0 0 25px rgba(182,156,255,0.25);
}

.tagline-text {
    color: #e0d7ff;
    font-size: 13px;
    letter-spacing: 0.3px;
    text-shadow: 0 0 10px rgba(182,156,255,0.5);
    animation: glowPulse 3s ease-in-out infinite;
}

@keyframes glowPulse {
    0%   { text-shadow: 0 0 6px rgba(182,156,255,0.4); }
    50%  { text-shadow: 0 0 14px rgba(182,156,255,0.9); }
    100% { text-shadow: 0 0 6px rgba(182,156,255,0.4); }
}

/* Form */
.form-group { margin-bottom: 18px; }

.form-group label {
    color: #ddd;
    font-weight: 500;
    margin-bottom: 6px;
    display: block;
}

.form-group input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 14px;
}

.form-group input::placeholder { color: #aaa; }

.form-group input:focus {
    outline: none;
    border-color: #8a6cff;
    box-shadow: 0 0 0 3px rgba(138,108,255,0.3);
}

.btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #b69cff, #8a6cff);
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(138,108,255,0.5);
    transition: transform .2s ease, box-shadow .2s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(138,108,255,0.8);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.link-group {
    text-align: center;
    margin-top: 22px;
}

.link-group a {
    color: #b69cff;
    text-decoration: none;
}
.link-group a:hover { text-decoration: underline; }

.alert {
    margin-bottom: 14px;
    padding: 10px 12px;
    border-radius: 8px;
    text-align: center;
}

.alert-success {
    background: rgba(0,255,120,0.15);
    color: #6affb0;
    border: 1px solid rgba(0,255,120,0.3);
}

.alert-error {
    background: rgba(255,60,60,0.15);
    color: #ff7b7b;
    border: 1px solid rgba(255,60,60,0.3);
}
/* Add this to your existing styles */

@media (max-width: 480px) {
    .container {
        padding: 24px 20px; /* Reduce padding on mobile */
    }
    
    .logo h1 {
        font-size: 24px; /* Slightly smaller logo */
    }
    
    .form-title {
        font-size: 20px;
    }
    
    .tagline-text {
        font-size: 12px;
    }
}

/* For very small screens */
@media (max-width: 360px) {
    .container {
        padding: 20px 16px;
    }
}
</style>
</head>

<body>
<div class="container">

    <div class="logo">
        <h1>ðŸ’¬ LetsChat</h1>
    </div>

    <h2 class="form-title">Create Account</h2>
    <p class="form-subtitle">Start chatting with friends</p>

    <!-- TAGLINE -->
    <div class="tagline-bar">
        <span class="tagline-text">
            âœ¨ Join rooms, create your own, and chat instantly
        </span>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <form id="registerForm">
        <div class="form-group">
            <label>Email Address</label>
            <input type="email" name="email" required placeholder="you@example.com">
        </div>

        <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" name="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
        </div>

        <div class="form-group">
            <label>Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>

        <button class="btn" type="submit">Create Account</button>
    </form>

    <div class="link-group">
        <p>Already have an account? <a href="/login">Sign In</a></p>
    </div>

</div>

<script>
const form = document.getElementById('registerForm');
const password = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');
const submitBtn = form.querySelector('.btn');

// Password match validation
confirmPassword.addEventListener('input', () => {
    confirmPassword.setCustomValidity(
        password.value !== confirmPassword.value ? 'Passwords do not match' : ''
    );
});

// Show alert function
function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.textContent = message;
    
    const container = document.getElementById('alertContainer');
    container.innerHTML = '';
    container.appendChild(alertDiv);
    
    setTimeout(() => alertDiv.remove(), 5000);
}

// Form submission
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Check password match one more time
    if (password.value !== confirmPassword.value) {
        showAlert('Passwords do not match', 'error');
        return;
    }
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Creating Account...';
    
    const formData = new FormData(form);
    const data = {
        email: formData.get('email'),
        password: formData.get('password')
    };
    
    try {
        // âœ… FIXED: Use /api/auth/register instead of /register
        const response = await fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showAlert('Account created successfully! Redirecting...', 'success');
            setTimeout(() => {
                // Use the redirect path from backend or default to /join
                window.location.href = result.redirect || '/join';
            }, 1500);
        } else {
            showAlert(result.message || 'Registration failed', 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create Account';
        }
    } catch (error) {
        console.error('Registration error:', error);
        showAlert('An error occurred. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Account';
    }
});
</script>
</body>
</html>