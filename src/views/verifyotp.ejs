<h2 class="form-title">Verify OTP</h2>
<p class="form-subtitle">Enter the code sent to your email</p>

<form id="verifyOTPForm">
    <div class="form-group">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" required readonly>
    </div>

    <div class="form-group">
        <label for="otp">OTP Code</label>
        <input type="text" id="otp" name="otp" required placeholder="123456" maxlength="6" pattern="[0-9]{6}">
    </div>

    <div class="form-group">
        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" name="newPassword" required placeholder="••••••••" minlength="6">
    </div>

    <div class="form-group">
        <label for="confirmPassword">Confirm New Password</label>
        <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="••••••••" minlength="6">
    </div>

    <button type="submit" class="btn">Reset Password</button>
    <div class="loading">Verifying...</div>
</form>

<div class="link-group">
    <a href="/forgot-password">Resend OTP</a>
    <div class="divider">or</div>
    <a href="/login">Back to Login</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const email = sessionStorage.getItem('resetEmail');

    if (email) {
        document.getElementById('email').value = email;
    } else {
        window.location.href = '/forgot-password';
    }

    const form = document.getElementById('verifyOTPForm');
    const newPassword = document.getElementById('newPassword');
    const confirmPassword = document.getElementById('confirmPassword');

    confirmPassword.addEventListener('input', () => {
        if (newPassword.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity('Passwords do not match');
        } else {
            confirmPassword.setCustomValidity('');
        }
    });

    handleFormSubmit('verifyOTPForm', '/api/auth/verifyOTP', '/login');

    form.addEventListener('submit', () => {
        setTimeout(() => {
            sessionStorage.removeItem('resetEmail');
        }, 2000);
    });
});
</script>
