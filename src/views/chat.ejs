<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chat: <%= room.room_name || 'Chat Room' %></title>
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <h1>Room: <%= room.room_name || 'Chat Room' %></h1>

  <!-- Connection Status -->
  <div id="status" style="padding:5px;background:yellow;margin:10px 0;">
    Connecting...
  </div>

  <!-- DEBUG INFO -->
  <div style="background:#f0f0f0;padding:10px;margin:10px 0;">
    <strong>Debug Info (Raw from server):</strong><br>
    User Object: <%= JSON.stringify(user) %><br>
    Room Object: <%= JSON.stringify(room) %><br>
    Socket URL: <%= socketUrl %><br>
    <hr>
    <strong>Extracted Values:</strong><br>
    User ID: <%= user?.id || 'UNDEFINED' %><br>
    Room ID: <%= room?.id || 'UNDEFINED' %><br>
  </div>

  <div id="messages"
       style="height:300px;overflow:auto;border:1px solid #ccc;padding:8px;">
  </div>

  <form id="sendForm">
    <input id="msg" autocomplete="off" placeholder="Type a message..." />
    <button type="submit">Send</button>
  </form>

  <!-- Pass data to client.js -->
  <script id="app-data" type="application/json">
    <%- JSON.stringify({
      user: {
        id: user?.id || null,
        username: user?.username || 'Unknown'
      },
      room: {
        id: room?.id || null,
        name: room?.room_name || 'Unknown'
      },
      socketUrl: socketUrl
    }) %>
  </script>

  <script src="/client.js"></script>
</body>
</html>